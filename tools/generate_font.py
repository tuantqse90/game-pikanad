#!/usr/bin/env python3
"""Generate a simple 8x8 pixel bitmap font PNG for Game Pikanad.
Creates a 128-character ASCII font atlas (16 cols x 8 rows) at 128x64 pixels.
"""

from PIL import Image, ImageDraw
import os

OUT_DIR = os.path.join(os.path.dirname(os.path.dirname(__file__)), "assets", "fonts")
os.makedirs(OUT_DIR, exist_ok=True)

CHAR_W, CHAR_H = 8, 8
COLS, ROWS = 16, 8  # 128 chars total
IMG_W, IMG_H = COLS * CHAR_W, ROWS * CHAR_H

# Simple 5x7 pixel font glyphs (stored as lists of strings)
# Each glyph is 5 pixels wide, 7 pixels tall, padded to 8x8
GLYPHS = {
    ' ': [
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
    ],
    '!': [
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "  #  ",
        "     ",
    ],
    '"': [
        " # # ",
        " # # ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
    ],
    '#': [
        " # # ",
        "#####",
        " # # ",
        "#####",
        " # # ",
        "     ",
        "     ",
    ],
    '$': [
        " ### ",
        "# #  ",
        " ### ",
        "  # #",
        " ### ",
        "     ",
        "     ",
    ],
    '%': [
        "#   #",
        "   # ",
        "  #  ",
        " #   ",
        "#   #",
        "     ",
        "     ",
    ],
    '&': [
        " ##  ",
        "#  # ",
        " ##  ",
        "# # #",
        " ## #",
        "     ",
        "     ",
    ],
    "'": [
        "  #  ",
        "  #  ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
    ],
    '(': [
        "   # ",
        "  #  ",
        "  #  ",
        "  #  ",
        "   # ",
        "     ",
        "     ",
    ],
    ')': [
        " #   ",
        "  #  ",
        "  #  ",
        "  #  ",
        " #   ",
        "     ",
        "     ",
    ],
    '*': [
        "     ",
        " # # ",
        "  #  ",
        " # # ",
        "     ",
        "     ",
        "     ",
    ],
    '+': [
        "     ",
        "  #  ",
        " ### ",
        "  #  ",
        "     ",
        "     ",
        "     ",
    ],
    ',': [
        "     ",
        "     ",
        "     ",
        "  #  ",
        "  #  ",
        " #   ",
        "     ",
    ],
    '-': [
        "     ",
        "     ",
        " ### ",
        "     ",
        "     ",
        "     ",
        "     ",
    ],
    '.': [
        "     ",
        "     ",
        "     ",
        "     ",
        "  #  ",
        "     ",
        "     ",
    ],
    '/': [
        "    #",
        "   # ",
        "  #  ",
        " #   ",
        "#    ",
        "     ",
        "     ",
    ],
    '0': [
        " ### ",
        "#  ##",
        "# # #",
        "##  #",
        " ### ",
        "     ",
        "     ",
    ],
    '1': [
        "  #  ",
        " ##  ",
        "  #  ",
        "  #  ",
        " ### ",
        "     ",
        "     ",
    ],
    '2': [
        " ### ",
        "#   #",
        "  ## ",
        " #   ",
        "#####",
        "     ",
        "     ",
    ],
    '3': [
        " ### ",
        "#   #",
        "  ## ",
        "#   #",
        " ### ",
        "     ",
        "     ",
    ],
    '4': [
        "#  # ",
        "#  # ",
        "#####",
        "   # ",
        "   # ",
        "     ",
        "     ",
    ],
    '5': [
        "#####",
        "#    ",
        "#### ",
        "    #",
        "#### ",
        "     ",
        "     ",
    ],
    '6': [
        " ### ",
        "#    ",
        "#### ",
        "#   #",
        " ### ",
        "     ",
        "     ",
    ],
    '7': [
        "#####",
        "   # ",
        "  #  ",
        " #   ",
        " #   ",
        "     ",
        "     ",
    ],
    '8': [
        " ### ",
        "#   #",
        " ### ",
        "#   #",
        " ### ",
        "     ",
        "     ",
    ],
    '9': [
        " ### ",
        "#   #",
        " ####",
        "    #",
        " ### ",
        "     ",
        "     ",
    ],
    ':': [
        "     ",
        "  #  ",
        "     ",
        "  #  ",
        "     ",
        "     ",
        "     ",
    ],
    ';': [
        "     ",
        "  #  ",
        "     ",
        "  #  ",
        " #   ",
        "     ",
        "     ",
    ],
    '<': [
        "   # ",
        "  #  ",
        " #   ",
        "  #  ",
        "   # ",
        "     ",
        "     ",
    ],
    '=': [
        "     ",
        " ### ",
        "     ",
        " ### ",
        "     ",
        "     ",
        "     ",
    ],
    '>': [
        " #   ",
        "  #  ",
        "   # ",
        "  #  ",
        " #   ",
        "     ",
        "     ",
    ],
    '?': [
        " ### ",
        "#   #",
        "  ## ",
        "     ",
        "  #  ",
        "     ",
        "     ",
    ],
    '@': [
        " ### ",
        "# # #",
        "# ## ",
        "#    ",
        " ### ",
        "     ",
        "     ",
    ],
    'A': [
        " ### ",
        "#   #",
        "#####",
        "#   #",
        "#   #",
        "     ",
        "     ",
    ],
    'B': [
        "#### ",
        "#   #",
        "#### ",
        "#   #",
        "#### ",
        "     ",
        "     ",
    ],
    'C': [
        " ### ",
        "#    ",
        "#    ",
        "#    ",
        " ### ",
        "     ",
        "     ",
    ],
    'D': [
        "#### ",
        "#   #",
        "#   #",
        "#   #",
        "#### ",
        "     ",
        "     ",
    ],
    'E': [
        "#####",
        "#    ",
        "###  ",
        "#    ",
        "#####",
        "     ",
        "     ",
    ],
    'F': [
        "#####",
        "#    ",
        "###  ",
        "#    ",
        "#    ",
        "     ",
        "     ",
    ],
    'G': [
        " ### ",
        "#    ",
        "# ###",
        "#   #",
        " ### ",
        "     ",
        "     ",
    ],
    'H': [
        "#   #",
        "#   #",
        "#####",
        "#   #",
        "#   #",
        "     ",
        "     ",
    ],
    'I': [
        " ### ",
        "  #  ",
        "  #  ",
        "  #  ",
        " ### ",
        "     ",
        "     ",
    ],
    'J': [
        "  ###",
        "   # ",
        "   # ",
        "#  # ",
        " ##  ",
        "     ",
        "     ",
    ],
    'K': [
        "#  # ",
        "# #  ",
        "##   ",
        "# #  ",
        "#  # ",
        "     ",
        "     ",
    ],
    'L': [
        "#    ",
        "#    ",
        "#    ",
        "#    ",
        "#####",
        "     ",
        "     ",
    ],
    'M': [
        "#   #",
        "## ##",
        "# # #",
        "#   #",
        "#   #",
        "     ",
        "     ",
    ],
    'N': [
        "#   #",
        "##  #",
        "# # #",
        "#  ##",
        "#   #",
        "     ",
        "     ",
    ],
    'O': [
        " ### ",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
    ],
    'P': [
        "#### ",
        "#   #",
        "#### ",
        "#    ",
        "#    ",
        "     ",
        "     ",
    ],
    'Q': [
        " ### ",
        "#   #",
        "# # #",
        "#  # ",
        " ## #",
        "     ",
        "     ",
    ],
    'R': [
        "#### ",
        "#   #",
        "#### ",
        "# #  ",
        "#  ##",
        "     ",
        "     ",
    ],
    'S': [
        " ####",
        "#    ",
        " ### ",
        "    #",
        "#### ",
        "     ",
        "     ",
    ],
    'T': [
        "#####",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
    ],
    'U': [
        "#   #",
        "#   #",
        "#   #",
        "#   #",
        " ### ",
        "     ",
        "     ",
    ],
    'V': [
        "#   #",
        "#   #",
        " # # ",
        " # # ",
        "  #  ",
        "     ",
        "     ",
    ],
    'W': [
        "#   #",
        "#   #",
        "# # #",
        "## ##",
        "#   #",
        "     ",
        "     ",
    ],
    'X': [
        "#   #",
        " # # ",
        "  #  ",
        " # # ",
        "#   #",
        "     ",
        "     ",
    ],
    'Y': [
        "#   #",
        " # # ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
    ],
    'Z': [
        "#####",
        "   # ",
        "  #  ",
        " #   ",
        "#####",
        "     ",
        "     ",
    ],
    '[': [
        " ##  ",
        " #   ",
        " #   ",
        " #   ",
        " ##  ",
        "     ",
        "     ",
    ],
    '\\': [
        "#    ",
        " #   ",
        "  #  ",
        "   # ",
        "    #",
        "     ",
        "     ",
    ],
    ']': [
        "  ## ",
        "   # ",
        "   # ",
        "   # ",
        "  ## ",
        "     ",
        "     ",
    ],
    '^': [
        "  #  ",
        " # # ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
    ],
    '_': [
        "     ",
        "     ",
        "     ",
        "     ",
        "#####",
        "     ",
        "     ",
    ],
    '`': [
        " #   ",
        "  #  ",
        "     ",
        "     ",
        "     ",
        "     ",
        "     ",
    ],
}

# Lowercase letters - same as uppercase for pixel font (common in retro games)
for c in "abcdefghijklmnopqrstuvwxyz":
    GLYPHS[c] = GLYPHS[c.upper()]

# Add remaining punctuation
GLYPHS.update({
    '{': GLYPHS['('],
    '}': GLYPHS[')'],
    '|': [
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "  #  ",
        "     ",
        "     ",
    ],
    '~': [
        "     ",
        " # # ",
        "# #  ",
        "     ",
        "     ",
        "     ",
        "     ",
    ],
})


def generate_font():
    img = Image.new("RGBA", (IMG_W, IMG_H), (0, 0, 0, 0))
    draw = ImageDraw.Draw(img)

    for ascii_code in range(128):
        char = chr(ascii_code)
        col = ascii_code % COLS
        row = ascii_code // COLS
        ox = col * CHAR_W
        oy = row * CHAR_H

        glyph = GLYPHS.get(char)
        if not glyph:
            continue

        for gy, glyph_row in enumerate(glyph):
            for gx, pixel in enumerate(glyph_row):
                if pixel == '#':
                    # Draw pixel with slight padding (1px left offset for centering)
                    draw.point((ox + gx + 1, oy + gy), fill=(255, 255, 255, 255))

    path = os.path.join(OUT_DIR, "pixel_font.png")
    img.save(path)
    print(f"Created pixel_font.png ({IMG_W}x{IMG_H})")
    return path


if __name__ == "__main__":
    generate_font()
